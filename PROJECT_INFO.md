# SorcerySW6 - Projekt-Informationen

## üìã Projekt-√úbersicht
**Projekt:** SorcerySW6 - Shopware 6 Development Environment mit TCG Manager Plugin
**Zweck:** Trading Card Game Manager Plugin f√ºr Shopware 6
**Repository:** https://github.com/yourHostJost/SorcerySW6
**Erstellt:** 2024
**Status:** ‚úÖ Plugin vollst√§ndig funktionsf√§hig (Stand: 2024-12-28)

## üõ†Ô∏è Technische Spezifikationen

### Software & Frameworks
| Komponente | Version | Zweck |
|------------|---------|-------|
| **Shopware** | 6.6.10.4 | E-Commerce Platform |
| **PHP** | 8.2 | Backend-Sprache |
| **MySQL** | 8.0 | Datenbank |
| **Docker** | Latest | Containerisierung |
| **Dockware** | dev:6.6.10.4 | Shopware Docker Image |
| **Symfony** | 6.x | Framework (Teil von Shopware) |
| **Twig** | 3.x | Template Engine |
| **Bootstrap** | 5.x | Frontend Framework |

### Entwicklungsumgebung
- **Docker Compose** f√ºr lokale Entwicklung
- **GitHub Actions** f√ºr CI/CD
- **Hetzner Cloud** f√ºr Production-Deployment
- **VSCode** als bevorzugte IDE

## üåê Umgebungen

### Lokale Entwicklung
- **URL:** http://localhost
- **Admin:** http://localhost/admin
- **Docker Setup:** `docker-compose.yml`
- **Ports:** 80 (HTTP), 443 (HTTPS), 3306 (MySQL), 22 (SSH), 8888 (Adminer), 9999 (Mailcatcher)

### Production (Hetzner Cloud)
- **URL:** http://91.99.27.91
- **Admin:** http://91.99.27.91/admin
- **Server:** Hetzner Cloud VPS
- **Docker Setup:** `docker-compose.production.yml`
- **SSH:** `ssh -i server_key root@91.99.27.91`

## üóÇÔ∏è Verzeichnisstruktur
```
SorcerySW6/
‚îú‚îÄ‚îÄ custom/plugins/TcgManager/          # TCG Manager Plugin
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Core/Content/               # Entity Definitionen
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Service/                    # Business Logic Services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Storefront/Controller/      # Frontend Controller
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Resources/                  # Templates, Config, Migrationen
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Migration/                  # Datenbank-Migrationen
‚îÇ   ‚îú‚îÄ‚îÄ composer.json                   # Plugin-Konfiguration
‚îÇ   ‚îî‚îÄ‚îÄ README.md                       # Plugin-Dokumentation
‚îú‚îÄ‚îÄ docker-compose.yml                  # Development Docker Setup
‚îú‚îÄ‚îÄ docker-compose.production.yml       # Production Docker Setup
‚îú‚îÄ‚îÄ .github/workflows/                  # GitHub Actions CI/CD
‚îú‚îÄ‚îÄ server_key                          # SSH Key f√ºr Hetzner Cloud
‚îî‚îÄ‚îÄ README.md                           # Projekt-Dokumentation
```

## üîê Anmeldedaten

### Lokale Entwicklung
- **Shopware Admin:** admin / shopware
- **MySQL:** shopware / shopware (Root: root / root)
- **SSH Container:** root / root

### Production (Hetzner Cloud)
- **SSH:** Schl√ºssel-basiert (`server_key`)
- **Shopware Admin:** [Wird bei Deployment gesetzt]
- **MySQL:** [Container-intern]

### GitHub
- **Repository:** https://github.com/yourHostJost/SorcerySW6
- **Branch:** staging (Hauptentwicklung)
- **Actions:** Automatisches Deployment bei Push

## üöÄ Deployment-Prozess
1. **Lokale Entwicklung** ‚Üí Code-√Ñnderungen
2. **Git Commit & Push** ‚Üí GitHub Repository
3. **GitHub Actions** ‚Üí Automatisches Deployment
4. **Hetzner Cloud** ‚Üí Production-Update

## üì¶ Plugin-Architektur

### TCG Manager Plugin ‚úÖ FUNKTIONSF√ÑHIG
- **Namespace:** TcgManager
- **Typ:** shopware-platform-plugin
- **Entities:** 5 Haupttabellen (Card, Collection, CollectionCard, Deck, DeckCard)
- **Services:** CollectionService, DeckService, CardService, ShopIntegrationService
- **Frontend:** Account-Integration mit Sidebar-Navigation
- **Status:** Collection-CRUD vollst√§ndig funktionsf√§hig, API-Authentifizierung repariert
- **Kartendaten:** 636 echte Sorcery-Karten importiert und funktionsf√§hig
- **Drag & Drop:** Vollst√§ndig implementiert mit Demo-Modus
- **Demo-URL:** `http://localhost/tcg/demo/drag-drop` (funktionsf√§hig)
- **Shop-URLs:** `http://localhost/tcg/shop` (Katalog), `http://localhost/tcg/shop/categories` (Kategorien)
- **Bekannte Probleme:** 4K-Display Layout-Optimierung ungel√∂st (2024-12-29)

## üîß Wichtige Befehle

### Docker Management
```bash
# Development starten
docker-compose up -d

# Production starten
docker-compose -f docker-compose.production.yml up -d

# Container stoppen
docker-compose down

# Logs anzeigen
docker-compose logs -f shopware
```

### Plugin Management
```bash
# Plugin refreshen
docker-compose exec shopware bin/console plugin:refresh

# Plugin installieren
docker-compose exec shopware bin/console plugin:install TcgManager --activate

# Cache leeren
docker-compose exec shopware bin/console cache:clear
```

### SSH Zugriff
```bash
# Hetzner Cloud Server
ssh -i server_key root@91.99.27.91

# Lokaler Container
docker-compose exec shopware bash
```

## üìä Performance-Optimierungen
- **HTTP Cache** aktiviert
- **Komprimierung** eingeschaltet
- **Cache Warming** implementiert
- **Optimierte Datenbankindizes**

## üîç Monitoring & Debugging
- **Error Logs:** `docker-compose logs shopware`
- **PHP Logs:** Container `/var/log/`
- **Browser DevTools:** Frontend-Debugging
- **Adminer:** http://localhost:8888 (Datenbank-Management)

## üîß Technische Erkenntnisse & Best Practices

### Shopware 6 AJAX-Entwicklung ‚ö° KRITISCH
- **AJAX-Routes:** `defaults: ['_routeScope' => ['storefront'], 'XmlHttpRequest' => true]` ZWINGEND erforderlich
- **Route-Scopes:** Korrekte Scope-Definition verhindert 403-Fehler bei AJAX-Requests
- **CSRF-Schutz:** `defaults={"csrf_protected"=false}` in Route-Annotation f√ºr API-Endpunkte
- **Session-Handling:** `credentials: 'same-origin'` in fetch-Requests f√ºr Session-basierte Authentifizierung
- **API-Authentifizierung:** `if (!$context->getCustomer())` statt `denyAccessUnlessLoggedIn()` f√ºr Customer-Checks
- **JavaScript-Integration:** `{% block base_body_script %}` mit `{{ parent() }}` f√ºr korrekte Script-Einbindung
- **FormData vs JSON:** FormData f√ºr CSRF-Token-kompatible Formulare, JSON f√ºr reine API-Calls
- **AJAX-Headers:** `X-Requested-With: XMLHttpRequest` f√ºr Shopware-AJAX-Erkennung

### Sorcery TCG API-Integration üÉè
- **API-Endpoint:** https://api.sorcerytcg.com/cards
- **Kartendaten:** 636 Karten, 3 Editionen, 4 Seltenheiten
- **Datenbank-Schema:** 15 neue Felder f√ºr Sorcery-Mechaniken
- **Performance:** Import in <2 Minuten, optimierte Indizes
- **Zuf√§lligkeit:** `mt_srand()` + `shuffle()` f√ºr echte Zuf√§lligkeit

### Frontend-Template-Debugging üîç
- **Problem:** AJAX-Requests ohne korrekte Route-Parameter ‚Üí 403 Forbidden
- **L√∂sung:** Shopware-Dokumentation als Referenz f√ºr systematische Fehlereingrenzung
- **Template-Trennung:** Server-seitige und AJAX-Container separieren
- **Error-Handling:** Detaillierte Console-Logs f√ºr besseres Debugging

### Shopware 6 Plugin SCSS ‚ö° KRITISCH
- **Korrekte Implementierung:** `src/Resources/app/storefront/src/scss/base.scss`
- **Build-Befehl:** `bin/build-storefront.sh` (NICHT `theme:compile`)
- **Unterschied zu Themes:** Plugins haben andere Build-Pipeline als Themes
- **Automatische Erkennung:** Shopware findet base.scss automatisch
- **Debug-Test:** `body { border-top: 5px solid red !important; }` zum Testen
- **Hot-Reload:** `bin/build-storefront.sh --hot` f√ºr Live-Entwicklung
- **Wichtig:** Theme-Dokumentation gilt NICHT f√ºr Plugins!

## üìù Notizen
- **Wichtig:** Immer `docker-compose.yml` f√ºr Development verwenden (hat Volume-Mapping)
- **SSH Key:** `server_key` f√ºr Hetzner Cloud Zugriff
- **Branches:** `staging` f√ºr Entwicklung, `main` f√ºr Production-Releases
- **Plugin-Pfad:** `/custom/plugins/TcgManager/` (gemountet in Development)
- **AJAX-Debugging:** Immer Shopware-Dokumentation zuerst konsultieren!

## üìã Arbeitsprotokoll

### 2024-12-28 - TCG Manager Plugin Reparatur
- **Problem:** Collection-CRUD, API-Authentifizierung und Deployment-Pipeline defekt
- **L√∂sung:** Systematische Reparatur aller Komponenten
- **Ergebnis:** Plugin vollst√§ndig funktionsf√§hig, 636 echte Sorcery-Karten importiert
- **Status:** ‚úÖ Abgeschlossen

### 2024-12-28 - Frontend-Template-Debugging
- **Problem:** Server-seitige und AJAX-Container √ºberschrieben sich
- **L√∂sung:** Getrennte Container f√ºr server-seitigen und AJAX-Content
- **Ergebnis:** Frontend-AJAX vollst√§ndig funktionsf√§hig
- **Status:** ‚úÖ Abgeschlossen

### 2024-12-28 - Drag & Drop Interface Implementation
- **Problem:** Collections-Management ben√∂tigt intuitive Benutzeroberfl√§che
- **L√∂sung:** Vollst√§ndiges Drag & Drop Interface mit echten Sorcery-Karten
- **Features:** Card Browser, Drop Zone, Collection Management, Demo-Modus
- **Status:** ‚úÖ Abgeschlossen

### 2024-12-29 - VOLLST√ÑNDIGER PRODUKTKATALOG ‚úÖ ABGESCHLOSSEN
- **Bildanalyse abgeschlossen:** 2.221 PNG-Bilder (1,8 GB) analysiert
- **Bildformat:** 380x531 Pixel, RGBA, ~810 KB pro Bild
- **Struktur:** 3 Editionen (Alpha, Beta, Arthurian Legends) √ó 10 Finish-Varianten
- **Namenskonvention:** `{kartenname}_{finish_code}.png` (konsistent)
- **Finish-Codes:** b_f/b_s (Base), bt_f/bt_s (Borderless), p_f/p_s (Promo), etc.
- **ProductSyncService:** Automatische Shopware-Produkterstellung implementiert
- **MediaUploadService:** Bildupload-Pipeline mit Multi-Finish-Support
- **Produktkatalog:** Vollst√§ndiger Shop mit Filter, Kategorien, Detailansichten
- **Navigation:** TCG-Shop in Hauptnavigation integriert
- **BULK-IMPORT ERFOLGREICH:** 596 Produkte aus 605 Karten (98,5% Erfolgsrate)
- **Performance:** 7min 18s f√ºr 596 Karten (~0,72s pro Karte inkl. Bildupload)
- **Editionen:** Alpha (405), Beta (9), Arthurian Legends (222) - alle importiert
- **Media-Pipeline:** Automatischer Upload aller verf√ºgbaren Finish-Varianten
- **Shop-Integration:** Vollst√§ndiger Katalog mit Filtern, Kategorien, Detailansichten
- **Ergebnis:** PRODUCTION-READY TCG-Shop mit 596 Produkten + tausenden Bildern

### 2024-12-29 - VOLLST√ÑNDIGE INTEGRATION ABGESCHLOSSEN ‚úÖ
- **Datenbank-Backup:** 8,5 MB SQL-Dump mit allen 636 Produkten erstellt
- **Git-Commit:** Vollst√§ndiger Code ohne Bilder committed und gepusht
- **Collections Card Browser:** Kartenbilder erfolgreich implementiert
- **API-Erweiterung:** Media-URLs in tcg/api/cards und tcg/random-cards
- **Template-Updates:** Beide Card-HTML-Funktionen mit Bildern erweitert
- **Deployment-Scripts:** Bereit f√ºr Bildupload zum Hetzner-Server
- **Authentisches Kartenformat:** 2:3 Verh√§ltnis wie echte TCG-Karten implementiert
- **Foil-Effekte:** Elegante Animationen nur auf Produkt-Detailseite bei Foil-Auswahl
- **Produktnummer-Fix:** 9 problematische Karten repariert, alle 636 Karten haben Produkte
- **Fehlende Bilder behoben:** 32 Karten ohne Bilder identifiziert und repariert
- **Katalog-Paginierung:** Limit von 24 auf 100 erh√∂ht, "Alle anzeigen" Option hinzugef√ºgt
- **Status:** VOLLST√ÑNDIG FUNKTIONSF√ÑHIGER TCG-SHOP + COLLECTIONS-SYSTEM MIT FOIL-EFFEKTEN

### 2024-12-29 - 4K-Display Layout-Optimierung ‚ö†Ô∏è UNGEL√ñST
- **Problem:** Layout auf gro√üem 4K-TV nicht optimal
  - Card Browser nach rechts versetzt (nicht b√ºndig mit √úberschrift)
  - Bootstrap-Grid zeigt 2 Bereiche untereinander statt nebeneinander
  - Sidebar-Navigation zu breit f√ºr gro√üe Displays

#### Durchgef√ºhrte L√∂sungsversuche:

1. **Inline-CSS im Template**
   - **Ansatz:** CSS direkt in collection-detail.html.twig
   - **Ergebnis:** ‚ùå Funktioniert nicht, wird √ºberschrieben

2. **SCSS nach Theme-Dokumentation**
   - **Ansatz:** SCSS-Datei + `theme:compile`
   - **Problem:** ‚ùå Falsche Dokumentation - gilt nur f√ºr Themes, nicht Plugins

3. **Korrekte Plugin-SCSS-Implementierung**
   - **Pfad:** `src/Resources/app/storefront/src/scss/base.scss`
   - **Build:** `bin/build-storefront.sh` (nicht `theme:compile`)
   - **Ergebnis:** ‚úÖ SCSS wird geladen (Debug-Rahmen sichtbar)

4. **CSS-Override-Strategien**
   - **Versuch 1:** Einfache Bootstrap-Grid-Overrides
   - **Versuch 2:** ULTRA-STRONG Selektoren mit !important
   - **Versuch 3:** MEGA-STRONG mit allen m√∂glichen Parent-Selektoren
   - **Versuch 4:** Minimalistischer Ansatz
   - **Versuch 5:** Gezielte Card Browser Container-Fixes
   - **Ergebnis:** ‚ùå Alle Versuche ohne Erfolg

#### Aktuelle Diagnose:
- ‚úÖ **SCSS-System funktioniert** - Roter Debug-Rahmen am Body sichtbar
- ‚ùå **Card Browser versetzt** - Debug-Rahmen nur innerhalb Card Browser
- ‚ùå **Bootstrap-Grid defekt** - col-lg-6 Bereiche stapeln sich vertikal
- ‚úÖ **HTML-Struktur korrekt** - row + col-lg-6 vorhanden
- üîç **Vermutung:** √úbergeordneter Container oder Shopware-spezifische CSS-Klassen √ºberschreiben Bootstrap

#### Technische Details der L√∂sungsversuche:

**SCSS-Implementierung (erfolgreich):**
- **Pfad:** `custom/plugins/TcgManager/src/Resources/app/storefront/src/scss/base.scss`
- **Build-Befehl:** `docker-compose exec shopware bin/build-storefront.sh`
- **Test:** `body { border-top: 5px solid red !important; }` ‚Üí ‚úÖ Funktioniert
- **Ergebnis:** SCSS wird korrekt geladen und angewendet

**CSS-Override-Versuche (alle erfolglos):**
1. **Einfache Selektoren:** `.drag-drop-container .row { display: flex !important; }`
2. **Starke Selektoren:** `.account-content .drag-drop-container .row`
3. **ULTRA-STRONG:** Alle m√∂glichen Parent-Container-Kombinationen
4. **MEGA-STRONG:** Zus√§tzlich mit Position- und Transform-Properties
5. **Minimalistisch:** Nur die n√∂tigsten CSS-Regeln
6. **Gezielt:** Spezifische Card Browser Container-Fixes

**Beobachtungen:**
- Debug-Rahmen erscheinen NUR innerhalb des Card Browsers
- √úberschrift, Text und Back-Button sind korrekt ausgerichtet
- HTML-Struktur ist korrekt: `<div class="row">` + `<div class="col-lg-6">`
- Alle CSS-Regeln mit !important werden ignoriert

**Vermutung:** Shopware-spezifische CSS-Klassen oder JavaScript √ºberschreiben Bootstrap-Grid

#### Dateien-Status nach Debugging:
- **base.scss:** Sauber mit TODO-Kommentaren, funktionsf√§hige Styles behalten
- **collection-detail.html.twig:** Debug-CSS entfernt, nur Kommentar-Verweis auf SCSS
- **PROJECT_INFO.md:** Vollst√§ndige Dokumentation aller Schritte

#### N√§chste Schritte (f√ºr neuen Chat):
1. **Browser DevTools:** Detaillierte CSS-Analyse der betroffenen Elemente
2. **Shopware CSS:** Identifikation der √ºberschreibenden CSS-Klassen
3. **JavaScript-L√∂sung:** Layout-Korrektur via JavaScript als Alternative
4. **Template-Umstrukturierung:** HTML-Layout komplett √ºberarbeiten
5. **Shopware-Community:** Problem in Shopware-Foren recherchieren

#### Wichtige Erkenntnisse f√ºr Fortsetzung:
- ‚úÖ SCSS-System funktioniert perfekt (Plugin-spezifische Implementierung)
- ‚ùå CSS-Overrides funktionieren nicht (Shopware √ºberschreibt Bootstrap)
- üîç Problem ist spezifisch f√ºr Card Browser (andere Elemente korrekt)
- üìã HTML-Struktur ist korrekt (Bootstrap-Grid-Syntax stimmt)
- üéØ User bevorzugt einfache HTML-L√∂sungen √ºber komplexe CSS-Overrides

#### Relevante Dateien f√ºr Layout-Problem:
```
custom/plugins/TcgManager/src/Resources/
‚îú‚îÄ‚îÄ app/storefront/src/scss/base.scss          # Plugin-SCSS (funktioniert)
‚îî‚îÄ‚îÄ views/storefront/page/account/
    ‚îî‚îÄ‚îÄ collection-detail.html.twig            # Template mit Layout-Problem
```

#### Wichtige Code-Stellen:
- **HTML-Grid:** Zeile 97-195 in collection-detail.html.twig
- **SCSS-TODO:** Zeile 8-25 in base.scss (auskommentierte Fixes)
- **Demo-Route:** `/tcg/demo/drag-drop` f√ºr Testing
- **Build-Befehl:** `docker-compose exec shopware bin/build-storefront.sh`

#### Browser-Test-URL f√ºr neuen Chat:
- **Demo-Seite:** `http://localhost/tcg/demo/drag-drop`
- **Erwartung:** 2 Spalten nebeneinander, Card Browser b√ºndig
- **Aktuell:** 2 Spalten untereinander, Card Browser nach rechts versetzt

- **Status:** üîß **UNGEL√ñST** - Vollst√§ndig dokumentiert, bereit f√ºr neue L√∂sungsans√§tze
