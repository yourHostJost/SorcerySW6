{% sw_extends '@Storefront/storefront/page/account/index.html.twig' %}

{% block page_account_main_content %}
    <div class="tcg-collections-page">
        <div class="account-welcome">
            <h1>{{ "tcg.collections.title"|trans }}</h1>
            <p class="lead">{{ "tcg.collections.description"|trans }}</p>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3 class="card-title mb-0">{{ "tcg.collections.my_collections"|trans }}</h3>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createCollectionModal">
                            <i class="fas fa-plus"></i> {{ "tcg.collections.create_new"|trans }}
                        </button>
                    </div>
                    <div class="card-body">
                        {% if collections|length > 0 %}
                            <div class="collections-grid">
                                {% for collection in collections %}
                                    <div class="collection-card" data-collection-id="{{ collection.id }}">
                                        <div class="collection-header">
                                            <h4 class="collection-name">
                                                <a href="{{ path('frontend.account.tcg.collection.detail', {'collectionId': collection.id}) }}">
                                                    {{ collection.name }}
                                                </a>
                                                {% if collection.isDefault %}
                                                    <span class="badge badge-primary">{{ "tcg.collections.default"|trans }}</span>
                                                {% endif %}
                                                {% if collection.isPublic %}
                                                    <span class="badge badge-success">{{ "tcg.collections.public"|trans }}</span>
                                                {% endif %}
                                            </h4>
                                        </div>
                                        <div class="collection-body">
                                            {% if collection.description %}
                                                <p class="collection-description">{{ collection.description }}</p>
                                            {% endif %}
                                            <div class="collection-stats">
                                                <span class="stat">
                                                    <i class="fas fa-layer-group"></i>
                                                    {{ collection.collectionCards ? collection.collectionCards|length : 0 }} {{ "tcg.collections.cards"|trans }}
                                                </span>
                                                <span class="stat">
                                                    <i class="fas fa-calendar"></i>
                                                    {{ collection.createdAt|date('d.m.Y') }}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="collection-actions">
                                            <a href="{{ path('frontend.account.tcg.collection.detail', {'collectionId': collection.id}) }}" 
                                               class="btn btn-outline-primary btn-sm">
                                                {{ "tcg.collections.view"|trans }}
                                            </a>
                                            <button type="button" class="btn btn-outline-secondary btn-sm" 
                                                    onclick="editCollection('{{ collection.id }}')">
                                                {{ "tcg.collections.edit"|trans }}
                                            </button>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state text-center py-5">
                                <i class="fas fa-layer-group fa-3x text-muted mb-3"></i>
                                <h4>{{ "tcg.collections.no_collections"|trans }}</h4>
                                <p class="text-muted">{{ "tcg.collections.no_collections_description"|trans }}</p>
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createCollectionModal">
                                    {{ "tcg.collections.create_first"|trans }}
                                </button>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0">{{ "tcg.collections.quick_actions"|trans }}</h3>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            <a href="{{ path('frontend.account.tcg.decks') }}" class="list-group-item list-group-item-action">
                                <i class="fas fa-layer-group"></i> {{ "tcg.decks.my_decks"|trans }}
                            </a>
                            <a href="{{ path('frontend.account.tcg.deck.feed') }}" class="list-group-item list-group-item-action">
                                <i class="fas fa-rss"></i> {{ "tcg.decks.deck_feed"|trans }}
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="showCardSearch()">
                                <i class="fas fa-search"></i> {{ "tcg.cards.search"|trans }}
                            </a>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h3 class="card-title mb-0">{{ "tcg.collections.statistics"|trans }}</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">{{ collections|length }}</div>
                                <div class="stat-label">{{ "tcg.collections.total_collections"|trans }}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">
                                    {% set totalCards = 0 %}
                                    {% for collection in collections %}
                                        {% set totalCards = totalCards + (collection.collectionCards ? collection.collectionCards|length : 0) %}
                                    {% endfor %}
                                    {{ totalCards }}
                                </div>
                                <div class="stat-label">{{ "tcg.collections.total_cards"|trans }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Collection Modal -->
    <div class="modal fade" id="createCollectionModal" tabindex="-1" aria-labelledby="createCollectionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createCollectionModalLabel">{{ "tcg.collections.create_new"|trans }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="createCollectionForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="collectionName" class="form-label">{{ "tcg.collections.name"|trans }} *</label>
                            <input type="text" class="form-control" id="collectionName" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="collectionDescription" class="form-label">{{ "tcg.collections.description"|trans }}</label>
                            <textarea class="form-control" id="collectionDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="collectionIsPublic" name="isPublic">
                            <label class="form-check-label" for="collectionIsPublic">
                                {{ "tcg.collections.make_public"|trans }}
                            </label>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="collectionIsDefault" name="isDefault">
                            <label class="form-check-label" for="collectionIsDefault">
                                {{ "tcg.collections.set_as_default"|trans }}
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ "tcg.common.cancel"|trans }}</button>
                        <button type="submit" class="btn btn-primary">{{ "tcg.collections.create"|trans }}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block page_account_main_content_inner_javascript %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Create collection form handler
            const createForm = document.getElementById('createCollectionForm');
            if (createForm) {
                createForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(createForm);
                    const data = {
                        name: formData.get('name'),
                        description: formData.get('description'),
                        isPublic: formData.get('isPublic') === 'on',
                        isDefault: formData.get('isDefault') === 'on'
                    };
                    
                    fetch('/api/tcg/collections', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            location.reload();
                        } else {
                            alert(result.message || 'Fehler beim Erstellen der Sammlung');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Ein Fehler ist aufgetreten');
                    });
                });
            }
        });

        function editCollection(collectionId) {
            // TODO: Implement edit collection functionality
            console.log('Edit collection:', collectionId);
        }

        function showCardSearch() {
            // TODO: Implement card search modal
            console.log('Show card search');
        }
    </script>

    <style>
        .collections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .collection-card {
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            transition: box-shadow 0.15s ease-in-out;
        }

        .collection-card:hover {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        .collection-name a {
            text-decoration: none;
            color: inherit;
        }

        .collection-name a:hover {
            color: #0d6efd;
        }

        .collection-stats {
            display: flex;
            gap: 1rem;
            margin: 0.5rem 0;
        }

        .collection-stats .stat {
            font-size: 0.875rem;
            color: #6c757d;
        }

        .collection-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0d6efd;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6c757d;
        }

        .empty-state {
            padding: 3rem 1rem;
        }
    </style>
{% endblock %}
